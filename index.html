<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FRED CITY - ADMIN EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
      :root{--blue:#6684ff;--cyan:#66d6ff;--teal:#078992;--darkteal:#316679;--bright:#0eefff;--yellow:#ffe566;--green:#5dea7a;--red:#ff5566;--purple:#a855f7;}*{margin:0;padding:0;box-sizing:border-box;}body{font-family:'Nunito',sans-serif;background:var(--blue);height:100vh;overflow:hidden; touch-action:none;}.screen{display:none;width:100vw;height:100vh;position:absolute;top:0;left:0;}.screen.active{display:flex;}
      
      /* ADMIN STYLES */
      #admin-pannel { position: fixed; top: 70px; right: 20px; width: 240px; background: rgba(0,0,0,0.9); border: 3px solid var(--purple); border-radius: 15px; padding: 15px; z-index: 1000; display: none; color: white; box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }
      #admin-pannel h2 { font-family: 'Fredoka One'; font-size: 1.2rem; color: var(--purple); margin-bottom: 10px; border-bottom: 1px solid #444; }
      .admin-btn { width: 100%; padding: 8px; margin-bottom: 8px; border: none; border-radius: 8px; font-family: 'Fredoka One'; cursor: pointer; transition: 0.2s; }
      .btn-game { background: var(--purple); color: white; }
      .btn-kick { background: var(--red); color: white; font-size: 0.7rem; padding: 4px; }
      .player-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-size: 0.8rem; background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 5px; }

      /* GAME POPUP */
      #game-invite-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8); background: linear-gradient(135deg, #1e1b4b, #312e81); border: 4px solid var(--cyan); border-radius: 25px; padding: 30px; z-index: 2000; display: none; text-align: center; color: white; box-shadow: 0 0 100px rgba(0,0,0,0.8); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
      #game-invite-popup.show { display: block; transform: translate(-50%, -50%) scale(1); }
      #game-invite-popup h1 { font-family: 'Fredoka One'; font-size: 2.5rem; margin-bottom: 10px; color: var(--yellow); }
      .join-btn { background: var(--green); border: none; padding: 15px 40px; border-radius: 15px; font-family: 'Fredoka One'; font-size: 1.5rem; cursor: pointer; margin-top: 20px; box-shadow: 0 5px 0 #2d7a42; }
      .join-btn:active { transform: translateY(3px); box-shadow: none; }

      /* Base Game Styles (Condensed for brevity) */
      #screen-title{flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(180deg, #112244 0%, #224488 100%);}
      .title-logo{font-family:'Fredoka One',cursive;display:flex;filter:drop-shadow(5px 5px 0 rgba(0,0,0,.55));margin-bottom:.6rem;}
      .title-logo-letter{font-size:clamp(3.5rem,8vw,6.5rem);color:var(--cyan);animation:letterBob 2.2s ease-in-out infinite;}
      @keyframes letterBob{0%,100%{transform:translateY(0)}50%{transform:translateY(-14px)}}
      .title-btn-play{background:var(--bright);border:none;border-radius:18px;padding:.9rem 4.5rem;color:var(--darkteal);font-family:'Fredoka One',cursive;font-size:1.4rem;cursor:pointer;box-shadow:0 6px 0 var(--darkteal);}
      #screen-map{flex-direction:column; background:#a2d149;} .map-header{height:56px;background:rgba(0,0,0,.55);display:flex;align-items:center;padding:0 1rem;gap:1rem;z-index:10;border-bottom:2px solid var(--cyan);}
      #map-canvas{width:100vw;height:calc(100vh - 56px);display:block;}
      .hud-coins{background:rgba(255,229,102,.12);border:2px solid var(--yellow);border-radius:20px;padding:.2rem .7rem;color:var(--yellow);margin-left:auto;}
      /* Auth and Shop styles assumed same as original */
      .loading-overlay{position:fixed;inset:0;background:var(--blue);z-index:4000;display:flex;flex-direction:column;align-items:center;justify-content:center;}
      .toast{position:fixed;bottom:1.5rem;right:1.5rem;background:rgba(0,0,20,.9);border:2px solid var(--cyan);border-radius:12px;padding:.8rem 1.2rem;color:#fff;transform:translateX(130%);transition:transform .3s;z-index:200;}
      .toast.show{transform:translateX(0);}
    </style>
  </head>
  <body>

    <div id="admin-pannel">
      <h2>üëë Admin Pannel</h2>
      <div id="game-controls">
        <button class="admin-btn btn-game" onclick="triggerGlobalGame('HideAndSeek')">Start Hide & Seek</button>
        <button class="admin-btn btn-game" style="background:var(--red)" onclick="endGlobalGame()">End Current Game</button>
      </div>
      <div style="margin-top:15px">
        <h3 style="font-size:0.7rem; text-transform:uppercase; color:#888">Online Players</h3>
        <div id="admin-player-list"></div>
      </div>
    </div>

    <div id="game-invite-popup">
        <h1 id="popup-game-name">GAME EVENT!</h1>
        <p id="popup-game-desc">A new game has started! Do you want to join?</p>
        <button class="join-btn" onclick="acceptGameInvite()">JOIN NOW</button>
        <button onclick="document.getElementById('game-invite-popup').classList.remove('show')" style="background:none; border:none; color:#888; cursor:pointer; display:block; margin: 10px auto;">Maybe later</button>
    </div>

    <div class="loading-overlay" id="loading">
      <div style="font-family:'Fredoka One'; font-size:3rem; color:var(--cyan)">FRED CITY</div>
      <div style="color:white">Loading Admin Modules...</div>
    </div>

    <div class="toast" id="toast"></div>

    <div class="screen active" id="screen-title">
      <div class="title-logo">
        <span class="title-logo-letter">F</span><span class="title-logo-letter">R</span><span class="title-logo-letter">E</span><span class="title-logo-letter">D</span>
        <div style="width:20px"></div>
        <span class="title-logo-letter">C</span><span class="title-logo-letter">I</span><span class="title-logo-letter">T</span><span class="title-logo-letter">Y</span>
      </div>
      <button class="title-btn-play" onclick="showScreen('screen-auth')">‚ñ∂ PLAY</button>
    </div>

    <div class="screen" id="screen-auth">
        <div style="background:rgba(0,0,0,0.5); padding:40px; border-radius:20px; text-align:center;">
            <h2 style="color:white; margin-bottom:20px;">Enter Fred City</h2>
            <input type="email" id="auth-email" placeholder="Email" style="padding:10px; width:100%; border-radius:10px; border:none; margin-bottom:10px;">
            <button class="title-btn-play" onclick="fakeLogin()" style="width:100%">LOGIN</button>
        </div>
    </div>

    <div class="screen" id="screen-map">
      <div class="map-header">
        <div style="font-family:'Fredoka One'; color:var(--cyan); font-size:1.2rem;">FRED CITY</div>
        <div id="game-status-indicator" style="color:var(--green); font-weight:bold; font-size:0.8rem; display:none;">‚óè GAME ACTIVE</div>
        <div class="hud-coins">ü™ô <span id="coin-count">0</span></div>
      </div>
      <canvas id="map-canvas"></canvas>
    </div>

    <script>
        // --- FIREBASE CONFIG ---
        // REPLACE WITH YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "ID",
            appId: "APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // --- GLOBAL STATE ---
        let G = { uid: null, email: "", username: "Player", coins: 100, isAdmin: false, inGame: false };
        let otherPlayers = {};
        const MAP_SIZE = { w: 3000, h: 2000 };
        const HIDE_MAP_SIZE = { w: 5000, h: 5000 };
        let currentMapSize = MAP_SIZE;
        
        const canvas = document.getElementById('map-canvas');
        const ctx = canvas.getContext('2d');
        const player = { x: 500, y: 500, speed: 5, size: 30, color: '#fff', isSeeker: false };
        const keys = {};

        // --- AUTH & ADMIN CHECK ---
        function fakeLogin() {
            const email = document.getElementById('auth-email').value;
            G.email = email;
            G.username = email.split('@')[0];
            G.uid = "user_" + Math.floor(Math.random()*1000);
            
            if(email === "masonlevihess@gmail.com") {
                G.isAdmin = true;
                document.getElementById('admin-pannel').style.display = 'block';
                showToast("Welcome back, Master Admin!");
            }
            
            showScreen('screen-map');
            initGame();
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'screen-map') {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight - 56;
            }
        }

        // --- ADMIN ACTIONS ---
        function triggerGlobalGame(gameType) {
            db.ref('global_game').set({
                type: gameType,
                active: true,
                startTime: Date.now(),
                seeker: "pending"
            });
            showToast("Game Broadcast Sent!");
        }

        function endGlobalGame() {
            db.ref('global_game').set({ active: false });
            db.ref('users').once('value', snap => {
                snap.forEach(child => {
                    db.ref(`users/${child.key}/current_game`).set(null);
                });
            });
        }

        function kickPlayer(uid) {
            db.ref(`users/${uid}/kicked`).set(true);
            showToast("Player Kicked!");
        }

        // --- GAME LOGIC ---
        function initGame() {
            document.getElementById('loading').style.display = 'none';
            
            // Listen for Global Games
            db.ref('global_game').on('value', snap => {
                const game = snap.val();
                if(game && game.active && !G.inGame) {
                    showGameInvite(game.type);
                } else if(!game || !game.active) {
                    exitMiniGame();
                }
            });

            // Listen for Kick
            db.ref(`users/${G.uid}/kicked`).on('value', snap => {
                if(snap.val() === true) {
                    alert("You have been kicked from the server.");
                    window.location.reload();
                }
            });

            // Update Admin Player List
            if(G.isAdmin) {
                db.ref('users').on('value', snap => {
                    const list = document.getElementById('admin-player-list');
                    list.innerHTML = '';
                    snap.forEach(child => {
                        const p = child.val();
                        if(child.key === G.uid) return;
                        const div = document.createElement('div');
                        div.className = 'player-row';
                        div.innerHTML = `<span>${p.username}</span><button class="btn-kick" onclick="kickPlayer('${child.key}')">KICK</button>`;
                        list.appendChild(div);
                    });
                });
            }

            requestAnimationFrame(gameLoop);
        }

        function showGameInvite(type) {
            const popup = document.getElementById('game-invite-popup');
            document.getElementById('popup-game-name').textContent = type === 'HideAndSeek' ? "HIDE & SEEK" : "NEW GAME";
            document.getElementById('popup-game-desc').textContent = "The Admin has started a game! Winner gets 50 coins!";
            popup.classList.add('show');
        }

        function acceptGameInvite() {
            G.inGame = true;
            currentMapSize = HIDE_MAP_SIZE;
            player.x = 2500; player.y = 2500; // Center of big map
            document.getElementById('game-invite-popup').classList.remove('show');
            document.getElementById('game-status-indicator').style.display = 'block';
            showToast("Joined Hide & Seek! Find a spot!");
        }

        function exitMiniGame() {
            G.inGame = false;
            currentMapSize = MAP_SIZE;
            document.getElementById('game-status-indicator').style.display = 'none';
        }

        // --- CORE LOOP ---
        window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            if(keys['w']) player.y -= player.speed;
            if(keys['s']) player.y += player.speed;
            if(keys['a']) player.x -= player.speed;
            if(keys['d']) player.x += player.speed;
            
            // Boundary checks
            player.x = Math.max(player.size, Math.min(currentMapSize.w - player.size, player.x));
            player.y = Math.max(player.size, Math.min(currentMapSize.h - player.size, player.y));

            // Sync with Firebase
            if(G.uid) {
                db.ref(`users/${G.uid}`).update({
                    x: player.x,
                    y: player.y,
                    username: G.username,
                    inGame: G.inGame
                });
            }
        }

        function render() {
            ctx.clearRect(0,0, canvas.width, canvas.height);
            
            // Simple camera
            const camX = player.x - canvas.width/2;
            const camY = player.y - canvas.height/2;
            
            ctx.save();
            ctx.translate(-camX, -camY);

            // Draw Background (Grass)
            ctx.fillStyle = G.inGame ? '#2d5a27' : '#a2d149';
            ctx.fillRect(0,0, currentMapSize.w, currentMapSize.h);

            // Draw Hiding Spots if in Game
            if(G.inGame) {
                ctx.fillStyle = '#1b3a18';
                for(let i=0; i<50; i++) { // Random bushes
                    ctx.beginPath();
                    ctx.arc((i*137)%currentMapSize.w, (i*223)%currentMapSize.h, 60, 0, Math.PI*2);
                    ctx.fill();
                }
            }

            // Draw You
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.size, 0, Math.PI*2);
            ctx.fill();
            ctx.fillStyle = "black";
            ctx.font = "bold 14px Arial";
            ctx.textAlign = "center";
            ctx.fillText("YOU (" + G.username + ")", player.x, player.y - 40);

            ctx.restore();
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

    </script>
  </body>
</html>
