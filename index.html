<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FRED CITY - ADMIN EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
      :root{--blue:#6684ff;--cyan:#66d6ff;--teal:#078992;--darkteal:#316679;--bright:#0eefff;--yellow:#ffe566;--green:#5dea7a;--red:#ff5566;}*{margin:0;padding:0;box-sizing:border-box;}body{font-family:'Nunito',sans-serif;background:var(--blue);height:100vh;overflow:hidden; touch-action:none;}.screen{display:none;width:100vw;height:100vh;position:absolute;top:0;left:0;}.screen.active{display:flex;}
      
      /* ADMIN PANEL STYLES */
      #admin-panel { display:none; position:fixed; right:20px; top:80px; width:280px; background:rgba(0,0,20,0.95); border:3px solid var(--bright); border-radius:18px; padding:1.5rem; z-index:1000; box-shadow:0 0 30px rgba(14,239,255,0.4); color:#fff; font-family:'Nunito',sans-serif;}
      #admin-panel h2 { font-family:'Fredoka One',cursive; color:var(--bright); margin-bottom:1rem; font-size:1.2rem; border-bottom:1px solid #333; padding-bottom:5px;}
      .admin-btn { width:100%; padding:10px; margin-bottom:8px; border-radius:10px; border:none; font-family:'Fredoka One',cursive; cursor:pointer; transition:0.2s; }
      .admin-btn.primary { background:var(--bright); color:#000; }
      .admin-btn.danger { background:var(--red); color:#fff; }
      .admin-player-list { max-height:150px; overflow-y:auto; background:rgba(255,255,255,0.05); border-radius:8px; padding:5px; margin-top:10px;}
      .admin-p-item { display:flex; justify-content:space-between; align-items:center; font-size:0.8rem; padding:4px; border-bottom:1px solid #222; }
      
      /* GAME SCREENS */
      #game-status-ui { position:fixed; top:70px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); padding:10px 20px; border-radius:30px; border:2px solid var(--yellow); color:var(--yellow); font-weight:800; display:none; z-index:100;}

      /* ... Keeping original styles for core components ... */
      :root{--blue:#6684ff;--cyan:#66d6ff;--teal:#078992;--darkteal:#316679;--bright:#0eefff;--yellow:#ffe566;--green:#5dea7a;--red:#ff5566;}*{margin:0;padding:0;box-sizing:border-box;}body{font-family:'Nunito',sans-serif;background:var(--blue);height:100vh;overflow:hidden; touch-action:none;}.screen{display:none;width:100vw;height:100vh;position:absolute;top:0;left:0;}.screen.active{display:flex;}
      #screen-title{flex-direction:column;align-items:center;justify-content:center;overflow:hidden;background:linear-gradient(180deg, #112244 0%, #224488 100%);}.title-snow{position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:1;}.snowflake{position:absolute;border-radius:50%;background:rgba(102,214,255,0.55);animation:snowfall linear infinite;}@keyframes snowfall{0%{transform:translateY(-20px);opacity:1}100%{transform:translateY(100vh) translateX(30px);opacity:0}}.title-logo{font-family:'Fredoka One',cursive;display:flex;align-items:center;gap:.2rem;filter:drop-shadow(5px 5px 0 rgba(0,0,0,.55));margin-bottom:.6rem;position:relative;z-index:2;}.title-logo-letter{font-size:clamp(3.5rem,8vw,6.5rem);color:var(--cyan);text-shadow:4px 4px 0 #000,6px 6px 0 rgba(0,0,0,.3);display:inline-block;animation:letterBob 2.2s ease-in-out infinite;}.title-logo-letter:nth-child(1){animation-delay:0s}.title-logo-letter:nth-child(2){animation-delay:.14s}.title-logo-letter:nth-child(3){animation-delay:.28s}.title-logo-letter:nth-child(4){animation-delay:.42s}.title-logo-gap{width:clamp(.6rem,2vw,1.4rem)}.title-logo-letter:nth-child(6){animation-delay:.56s}.title-logo-letter:nth-child(7){animation-delay:.70s}.title-logo-letter:nth-child(8){animation-delay:.84s}.title-logo-letter:nth-child(9){animation-delay:.98s}@keyframes letterBob{0%,100%{transform:translateY(0)}50%{transform:translateY(-14px)}}.title-btn-play{background:var(--bright);border:none;border-radius:18px;padding:.9rem 4.5rem;color:var(--darkteal);font-family:'Fredoka One',cursive;font-size:clamp(1.4rem,3vw,2rem);cursor:pointer;letter-spacing:.05em;position:relative;z-index:2;box-shadow:0 6px 0 var(--darkteal),0 0 30px rgba(14,239,255,.55);transition:all .15s;}.title-btn-play:hover{transform:translateY(-3px);box-shadow:0 9px 0 var(--darkteal),0 0 45px rgba(14,239,255,.75);}.title-btn-play:active{transform:translateY(3px);box-shadow:0 3px 0 var(--darkteal);}
      #screen-map{flex-direction:column; background:#a2d149;} .map-header{position:absolute;top:0;left:0;right:0;height:56px;background:rgba(0,0,20,.85);backdrop-filter:blur(8px);border-bottom:2px solid var(--cyan);display:flex;align-items:center;padding:0 1rem;gap:1rem;z-index:10;}.map-header-title{font-family:'Fredoka One',cursive;color:var(--cyan);font-size:1.3rem;letter-spacing:.05em;}.hud-coins{background:rgba(255,229,102,.12);border:2px solid var(--yellow);border-radius:20px;padding:.2rem .7rem;color:var(--yellow);font-weight:800;font-size:.9rem;display:flex;align-items:center;gap:.3rem;margin-left:auto;}
      #map-canvas{position:absolute;top:56px;left:0;width:100vw;height:calc(100vh - 56px);display:block;}
      .invite-notif{position:fixed;top:1.5rem;left:50%;transform:translateX(-50%) translateY(-150%);opacity: 0; pointer-events: none;background:linear-gradient(135deg,#1a2a4a,#2a3a5e);border:3px solid var(--cyan);border-radius:18px;padding:1.2rem 1.5rem;min-width:320px;max-width:90vw;box-shadow:0 0 30px rgba(102,214,255,.4),0 10px 40px rgba(0,0,0,.5);z-index:500;transition:transform .4s cubic-bezier(.34,1.56,.64,1), opacity .4s ease;text-align:center;}.invite-notif.show{transform:translateX(-50%) translateY(0);opacity: 1; pointer-events: auto;}.invite-notif-title{font-family:'Fredoka One',cursive;color:var(--cyan);font-size:1.2rem;margin-bottom:.2rem;}
      .toast{position:fixed;bottom:1.5rem;right:1.5rem;background:rgba(0,0,20,.9);border:2px solid var(--cyan);border-radius:12px;padding:.8rem 1.2rem;color:#fff;font-weight:700;font-size:.9rem;transform:translateX(130%);transition:transform .3s;z-index:1200;max-width:260px;}.toast.show{transform:translateX(0);}
      .auth-box{background:rgba(0,0,0,.45);border:3px solid var(--cyan);border-radius:22px;padding:2rem 2.5rem;width:clamp(300px,90vw,380px);backdrop-filter:blur(12px);position:relative;z-index:2;} .auth-field input{width:100%;padding:.7rem 1rem;background:rgba(0,0,0,.4);border:2px solid rgba(102,214,255,.35);border-radius:10px;color:#fff;margin-top:5px;}
      .btn-main{width:100%;padding:.9rem;background:var(--cyan);border:none;border-radius:12px;color:#000;font-family:'Fredoka One',cursive;font-size:1.2rem;cursor:pointer;transition:all .15s;box-shadow:0 4px 0 var(--darkteal);}.btn-main:hover{transform:translateY(-2px);box-shadow:0 6px 0 var(--darkteal);}
    </style>
  </head>
  <body>
    <div class="toast" id="toast"></div>

    <div id="game-status-ui">üéÆ GAME IN PROGRESS: <span id="game-type-label">...</span></div>

    <div id="admin-panel">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <h2>üëë ADMIN PANNEL</h2>
        <button onclick="document.getElementById('admin-panel').style.display='none'" style="background:none; border:none; color:white; cursor:pointer;">‚úï</button>
      </div>
      <p style="font-size:0.7rem; color:#aaa; margin-bottom:10px;">Logged in as: masonlevihess@gmail.com</p>
      
      <div style="margin-bottom:15px;">
        <p style="font-size:0.8rem; font-weight:bold; margin-bottom:5px;">ACTIVATE GLOBAL GAME</p>
        <button class="admin-btn primary" onclick="triggerGlobalGame('Hide and Seek')">üôà Start Hide & Seek</button>
        <button class="admin-btn primary" onclick="triggerGlobalGame('Freeze Tag')">‚ùÑÔ∏è Start Freeze Tag</button>
      </div>

      <div style="margin-bottom:15px;">
        <p style="font-size:0.8rem; font-weight:bold; margin-bottom:5px;">CONTROLS</p>
        <button class="admin-btn danger" onclick="endGlobalGame()">üõë End Current Game</button>
      </div>

      <p style="font-size:0.8rem; font-weight:bold;">PLAYERS ONLINE</p>
      <div class="admin-player-list" id="admin-p-list">
        </div>
    </div>

    <div class="invite-notif" id="game-invite">
      <div class="invite-notif-title" id="game-invite-title">üéÆ NEW GAME!</div>
      <div id="game-invite-desc" style="color:rgba(255,255,255,0.7); margin-bottom:15px; font-size:0.9rem;">The Admin has started a game! Want to join?</div>
      <div style="display:flex; gap:10px;">
        <button onclick="joinGlobalGame()" style="flex:1; padding:10px; background:var(--green); border:none; border-radius:10px; font-family:'Fredoka One',cursive; cursor:pointer;">JOIN NOW</button>
        <button onclick="document.getElementById('game-invite').classList.remove('show')" style="flex:1; padding:10px; background:rgba(255,255,255,0.1); border:1px solid #666; color:#fff; border-radius:10px; cursor:pointer;">LATER</button>
      </div>
    </div>

    <div class="screen active" id="screen-title">
      <div class="title-logo"><span class="title-logo-letter">F</span><span class="title-logo-letter">R</span><span class="title-logo-letter">E</span><span class="title-logo-letter">D</span><div class="title-logo-gap"></div><span class="title-logo-letter">C</span><span class="title-logo-letter">I</span><span class="title-logo-letter">T</span><span class="title-logo-letter">Y</span></div>
      <button class="title-btn-play" onclick="showScreen('screen-auth')">‚ñ∂ PLAY</button>
    </div>

    <div class="screen" id="screen-auth">
      <div class="auth-box">
        <h2 style="color:var(--cyan); font-family:'Fredoka One',cursive; text-align:center; margin-bottom:20px;">JOIN THE CITY</h2>
        <div class="auth-field"><input type="email" id="auth-email" placeholder="Email Address" /></div>
        <div class="auth-field"><input type="password" id="auth-pass" placeholder="Password" /></div>
        <button class="btn-main" onclick="doAuth()" style="margin-top:20px;">ENTER FRED CITY</button>
      </div>
    </div>

    <div class="screen" id="screen-map">
      <div class="map-header">
        <div class="map-header-title">üó∫Ô∏è FRED WORLD</div>
        <div class="hud-coins">ü™ô <span id="coin-count">0</span></div>
      </div>
      <canvas id="map-canvas"></canvas>
    </div>

    <script>
      // CONFIG & INITIALIZATION
      const firebaseConfig = { 
        apiKey: "AIzaSyCYydCGhgmawcrjwNXf_0eqTaDe-O6p1eQ", 
        authDomain: "fred-city.firebaseapp.com", 
        databaseURL: "https://fred-city-default-rtdb.firebaseio.com", 
        projectId: "fred-city", 
        storageBucket: "fred-city.firebasestorage.app", 
        messagingSenderId: "961837899685", 
        appId: "1:961837899685:web:297780aa142021853fd24c"
      };
      
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const auth = firebase.auth();

      let G = { uid: null, email: '', username: 'Fred', coins: 0, isAdmin: false, inGame: false };
      let players = {};
      let currentGame = null;

      // CORE SYSTEM
      function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'screen-map') initMap();
      }

      function doAuth() {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-pass').value;
        auth.signInWithEmailAndPassword(email, pass).then(u => {
          G.uid = u.user.uid;
          G.email = u.user.email;
          if(G.email === "masonlevihess@gmail.com") G.isAdmin = true;
          db.ref('users/' + G.uid).update({ online: true, email: G.email });
          loadData();
          showScreen('screen-map');
          showToast("Welcome back, " + G.email.split('@')[0]);
        }).catch(e => showToast(e.message));
      }

      function loadData() {
        db.ref('users/' + G.uid).on('value', snap => {
          if(snap.exists()) {
            G.coins = snap.val().coins || 0;
            document.getElementById('coin-count').textContent = G.coins;
          }
        });

        // Listen for Global Games (Admin Actions)
        db.ref('global_game').on('value', snap => {
          const game = snap.val();
          if(game && game.active) {
            currentGame = game;
            document.getElementById('game-status-ui').style.display = 'block';
            document.getElementById('game-type-label').textContent = game.type.toUpperCase();
            
            if(!G.inGame) {
              document.getElementById('game-invite-title').textContent = "üö® " + game.type.toUpperCase();
              document.getElementById('game-invite-desc').textContent = "The Admin has started a game of " + game.type + "! Click JOIN to enter the special map.";
              document.getElementById('game-invite').classList.add('show');
            }
          } else {
            currentGame = null;
            G.inGame = false;
            document.getElementById('game-status-ui').style.display = 'none';
            document.getElementById('game-invite').classList.remove('show');
          }
        });

        // Listen for online players (for Admin List)
        db.ref('users').on('value', snap => {
          players = snap.val() || {};
          if(G.isAdmin) updateAdminPlayerList();
        });
      }

      // ADMIN FUNCTIONS
      function updateAdminPlayerList() {
        const list = document.getElementById('admin-p-list');
        list.innerHTML = '';
        Object.keys(players).forEach(id => {
          if(players[id].online) {
            const div = document.createElement('div');
            div.className = 'admin-p-item';
            div.innerHTML = `<span>${players[id].email}</span> <button onclick="kickPlayer('${id}')" style="color:red; background:none; border:none; cursor:pointer;">KICK</button>`;
            list.appendChild(div);
          }
        });
      }

      function triggerGlobalGame(type) {
        db.ref('global_game').set({
          active: true,
          type: type,
          startTime: Date.now(),
          admin: G.uid,
          map: type === 'Hide and Seek' ? 'forest_extreme' : 'arena'
        });
        showToast("Game Started: " + type);
      }

      function endGlobalGame() {
        db.ref('global_game').set({ active: false });
        showToast("All games ended.");
      }

      function kickPlayer(uid) {
        if(uid === G.uid) return;
        db.ref('users/' + uid).update({ online: false });
        showToast("Player kicked.");
      }

      // GAMEPLAY LOGIC
      function joinGlobalGame() {
        G.inGame = true;
        document.getElementById('game-invite').classList.remove('show');
        
        // Logic for map switch
        if(currentGame.type === 'Hide and Seek') {
          map.player.x = 5000; // Teleport to the "Secret Forest" area of the map
          map.player.y = 5000;
          showToast("Teleported to Secret Forest! HIDE!");
        }
      }

      // MAP ENGINE
      const map = { canvas: null, ctx: null, player: { x: 1200, y: 1300, size: 25 }, keys: {} };

      function initMap() {
        map.canvas = document.getElementById('map-canvas');
        map.canvas.width = window.innerWidth;
        map.canvas.height = window.innerHeight - 56;
        map.ctx = map.canvas.getContext('2d');
        
        window.addEventListener('keydown', e => map.keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => map.keys[e.key.toLowerCase()] = false);
        
        // ADMIN PANEL TRIGGER: Click your own character
        map.canvas.onclick = (e) => {
           if(G.isAdmin) document.getElementById('admin-panel').style.display = 'block';
        };

        requestAnimationFrame(mapLoop);
      }

      function mapLoop() {
        if(!document.getElementById('screen-map').classList.contains('active')) return;
        update();
        render();
        requestAnimationFrame(mapLoop);
      }

      function update() {
        if(map.keys['w']) map.player.y -= 5;
        if(map.keys['s']) map.player.y += 5;
        if(map.keys['a']) map.player.x -= 5;
        if(map.keys['d']) map.player.x += 5;
        
        // Sync position to Firebase
        if(G.uid) db.ref('users/'+G.uid).update({ x: map.player.x, y: map.player.y });
      }

      function render() {
        const ctx = map.ctx;
        ctx.clearRect(0, 0, map.canvas.width, map.canvas.height);
        
        // Draw World (Simple representation)
        ctx.fillStyle = G.inGame ? '#1a4a1a' : '#a2d149'; // Darker for hide and seek
        ctx.fillRect(0, 0, map.canvas.width, map.canvas.height);

        // Draw Player
        ctx.fillStyle = G.isAdmin ? 'gold' : 'white';
        ctx.beginPath();
        ctx.arc(map.canvas.width/2, map.canvas.height/2, map.player.size, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = "#000";
        ctx.textAlign = 'center';
        ctx.fillText(G.isAdmin ? "üëë YOU (ADMIN)" : "YOU", map.canvas.width/2, map.canvas.height/2 - 35);
      }

      function showToast(m) {
        const t = document.getElementById('toast');
        t.textContent = m; t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
      }
    </script>
  </body>
</html>
